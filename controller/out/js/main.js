!function(a,b){b["true"]=a;{var c=function(){var a=function(){this.tips=["Maybe you should try not to kiss planets?","UFO's aren't that fond of rockets..","You can do better! Try agian! C'mon!","I agree it can be hot inside the rocket.. But this?","Can we agree to not do this from now on?"]};return a}(),d=function(){function a(){return this.socket=io.connect("http://"+window.location.host),this.code=0,this.emitOrientation=!0,this.emitSpeed=!1,this.emitTimeout=null,this.sliderHeight=void 0,this.player=1,this.twoPlayers=!1,this.settings=new c,FastClick.attach(document.body),window.DeviceOrientationEvent?(this.bind(),void 0):(window.alert("this device cannot be used as a controller"),!1)}return a.prototype.bind=function(){var a=this;document.getElementById("game-id-submit").onclick=function(b){b.preventDefault(),b.stopPropagation(),a.code=document.getElementById("game-id").value,a.socket.emit("join:request",{code:a.code})},document.body.ontouchmove=function(b){b.preventDefault();var c=b.pageY/document.height;c>1?c=1:0>c&&(c=0),a.emitSpeed&&(a.showSpeedOnControlPanel(1-c),a.socket.emit("speed:change",{speed:2*(1-c)}),a.emitSpeed=!1,a.emitSpeedTimeout=setTimeout(function(){a.emitSpeed=!0},50))},this.socket.on("join:accept",function(b){console.log(b),a.player=b.player;var c=document.getElementById("login"),d=document.getElementsByTagName("h1");c.parentNode.removeChild(d[0]),c.parentNode.removeChild(c),$("#speedSlider").removeClass("out"),a.sliderHeight=$("#speedSlider").height()}),this.socket.on("join:player2",function(){switch(console.log("[CONTROLLER] seccondPlayerHasJoined"),a.twoPlayers=!0,a.player){case 1:a.emitSpeed=!1,$(".speed-o-meter, .speed-instructions").addClass("dim"),$(".speed-instructions p").html("Your partner is now controlling the speed...");break;case 2:a.startLevel(),a.emitSpeed=!0,$("div.heading-meter, div.heading-instructions").addClass("dim"),$(".heading-instructions p").html("Your partner is now controlling the direction...")}}),this.socket.on("gameplay:start",function(){console.log("[CONTROLLER] received gameplay:start event through socket"),a.startLevel()}),this.socket.on("gameplay:restart",function(){switch(console.log("[CONTROLLER] received gameplay:restart event through socket"),a.player){case 1:a.startLevel(),a.twoPlayers&&(a.emitSpeed=!1,$(".speed-o-meter, .speed-instructions").addClass("dim"));break;case 2:a.startLevel(),a.emitSpeed=!0,$("div.heading-meter, div.heading-instructions").addClass("dim")}}),this.socket.on("gameplay:stop",function(){console.log("[CONTROLLER] gameplay:stop received"),a.stopLevel()}),this.socket.on("code:wrong",function(){alert("Game not found, please check try again with the correct code")}),this.socket.on("code:full",function(){alert("This room is full! :-(")})},a.prototype.handleCode=function(){},a.prototype.startLevel=function(){var a=this;console.log("[CONTROLLER] startLevel");var b=document.getElementById("restartButton");null!==b&&b.parentNode.removeChild(b);var c=document.getElementById("tip");null!==c&&c.parentNode.removeChild(c),$("#speedSlider").hasClass("out")&&$("#speedSlider").removeClass("out"),1===this.player&&(this.emitOrientation=!0,this.emitSpeed=!0,window.addEventListener("deviceorientation",function(b){var c=b.gamma;-180>c?c=-180:c>180&&(c=180),a.emitOrientation&&(a.socket.emit("move",{tilt:c}),a.emitOrientation=!1,a.showHeadingOnControlPanel(c),a.emitTimeout=setTimeout(function(){a.emitOrientation=!0},50))},!1))},a.prototype.stopLevel=function(){console.log("[CONTROLLER] in stopLevel"),window.removeEventListener("deviceorientation"),console.log("[CONTROLLER] removedEventListener"),this.emitOrientation=!1,this.emitTimeout=null,this.emitSpeed=!1,this.emitSpeedTimeout=null,window.removeEventListener("deviceorientation"),this.showSpeedOnControlPanel(0),this.showHeadingOnControlPanel(0),$(".dim").removeClass("dim"),$("#speedSlider").addClass("out");var a=(document.getElementById("speedSlider"),document.createElement("a"));a.setAttribute("href","#"),a.setAttribute("id","restartButton"),a.setAttribute("class","out"),a.innerHTML="Restart?",document.getElementById("speedSlider").appendChild(a),setTimeout(function(){$("#restartButton").removeClass("out")},1);var b=document.createElement("div");b.setAttribute("class","out"),b.setAttribute("id","tip"),document.getElementById("speedSlider").appendChild(b),$("#tip").html(this.settings.tips[Math.floor(Math.random()*this.settings.tips.length)]),setTimeout(function(){$("#tip").removeClass("out")},1);var c=this;document.getElementById("restartButton").addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),c.socket.emit("gameplay:restart")})},a.prototype.showHeadingOnControlPanel=function(a){var b=(a+90)/180*100;$(".indicator").css({left:b+"%"})},a.prototype.showSpeedOnControlPanel=function(a){var b=180*a-90;$(".needle").css({WebkitTransform:"rotate("+b+"deg)"})},a}();new d}}({},function(){return this}());